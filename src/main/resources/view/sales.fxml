<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Spinner?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.VBox?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.shopmanager.controller.SalesController">
    <top>
        <HBox spacing="20" alignment="CENTER_LEFT" styleClass="appbar">
            <children>
                <Button fx:id="backBtn" text="←" styleClass="button,icon"/>
                <VBox spacing="2">
                    <children>
                        <Label text="Nouvelle Vente" styleClass="title"/>
                        <Label text="Créer une nouvelle transaction" styleClass="caption"/>
                    </children>
                </VBox>
                <Pane HBox.hgrow="ALWAYS"/>
                <Label text="Client :" styleClass="form-label"/>
                <ComboBox fx:id="customerCombo" prefWidth="250"/>
            </children>
        </HBox>
    </top>
    <center>
        <GridPane hgap="20" vgap="20" styleClass="p-lg">
            <columnConstraints>
                <ColumnConstraints percentWidth="60"/>
                <ColumnConstraints percentWidth="40"/>
            </columnConstraints>

            <!-- Products Column -->
            <VBox spacing="16" GridPane.columnIndex="0" styleClass="card">
                <children>
                    <Label text="Catalogue Produits" styleClass="subtitle"/>
                    <!-- Barcode Scan Field -->
                    <HBox alignment="CENTER_LEFT" spacing="8">
                        <Label text="Scanner un produit:" styleClass="form-label"/>
                        <TextField fx:id="barcodeScanField" promptText="Scannez le code-barres ici" HBox.hgrow="ALWAYS"/>
                    </HBox>
                    <TableView fx:id="productsTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="pName" text="Nom" prefWidth="250"/>
                            <TableColumn fx:id="pPrice" text="Prix" prefWidth="120"/>
                            <TableColumn fx:id="pQty" text="Stock" prefWidth="80"/>
                        </columns>
                    </TableView>
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="card,glass">
                        <padding><Insets top="12" right="16" bottom="12" left="16"/></padding>
                        <children>
                            <Label text="Quantité:" styleClass="form-label"/>
                            <Spinner fx:id="qtySpinner" prefWidth="100" editable="true"/>
                            <Pane HBox.hgrow="ALWAYS"/>
                            <Button fx:id="addToCartBtn" text="➕ Ajouter au panier" styleClass="button,primary"/>
                        </children>
                    </HBox>
                </children>
            </VBox>

            <!-- Cart Column -->
            <VBox spacing="16" GridPane.columnIndex="1" styleClass="card">
                <children>
                    <Label text="Panier Actuel" styleClass="subtitle"/>
                    <TableView fx:id="cartTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="cName" text="Produit" prefWidth="200"/>
                            <TableColumn fx:id="cQty" text="Qté" prefWidth="60"/>
                            <TableColumn fx:id="cPrice" text="Total" prefWidth="120"/>
                        </columns>
                    </TableView>
                    <VBox spacing="12">
                        <children>
                            <HBox alignment="BASELINE_RIGHT">
                                <children>
                                    <Label fx:id="vatLabel" text="TVA: 0.00 MRU" styleClass="body"/>
                                </children>
                            </HBox>
                            <HBox alignment="BASELINE_RIGHT">
                                <children>
                                    <Label text="Total:" styleClass="subtitle"/>
                                    <Label fx:id="totalLabel" text="0.00 MRU" styleClass="title"/>
                                </children>
                            </HBox>
                            <Button fx:id="finalizeBtn" text="✅ Finaliser la Vente" styleClass="button,success" maxWidth="Infinity"/>
                        </children>
                    </VBox>
                </children>
            </VBox>
        </GridPane>
    </center>
</BorderPane>